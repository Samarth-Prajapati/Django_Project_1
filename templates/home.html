{% extends "base.html" %}
{% block content %}
<div class="container-fluid px-4">
    <!-- Hero Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body text-center py-5">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h1 class="display-4 fw-bold mb-3">
                                <i class="fas fa-chart-line me-3"></i>
                                Project & Resource Dashboard
                            </h1>
                            <p class="lead mb-4">Comprehensive analytics and insights for your team's productivity</p>
                            <div class="d-flex justify-content-center gap-3">
                                <a href="{% url 'projects:project_list' %}" class="btn btn-light btn-lg">
                                    <i class="fas fa-project-diagram me-2"></i>View Projects
                                </a>
                                <a href="{% url 'resources:resource_list' %}" class="btn btn-outline-light btn-lg">
                                    <i class="fas fa-users me-2"></i>Manage Resources
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="text-center">
                                <i class="fas fa-chart-pie" style="font-size: 8rem; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Current Selection Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="mb-3">
                                <i class="fas fa-filter text-primary me-2"></i>
                                Current Selection
                            </h4>
                            <div class="d-flex align-items-center gap-2">
                                <div class="badge bg-primary fs-6 px-3 py-2">
                                    <i class="fas fa-calendar me-2"></i>Year {{ year }}
                                </div>
                                <div class="badge bg-primary fs-6 px-3 py-2">
                                    <i class="fas fa-calendar-alt me-2"></i>Month {{ month }}
                                </div>
                            </div>
                            <small class="text-muted mt-2 d-block">
                                <i class="fas fa-info-circle me-1"></i>
                                This filter applies to all sections: Projects, Resources, and Attendance
                            </small>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="quick-stats">
                                <p class="mb-1 text-muted">Quick Access</p>
                                <div class="d-flex gap-2 justify-content-end">
                                    <a href="{% url 'projects:attendance_home' %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-calendar-check me-1"></i>Attendance
                                    </a>
                                    <a href="{% url 'projects:project_canvas_tree_visualization' %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-sitemap me-1"></i>Project Tree
                                    </a>
                                    <a href="{% url 'resources:resource_canvas_tree_visualization' %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-users me-1"></i>Resource Tree
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Month/Year Selection Section -->
    <div class="row">
        <div class="col-12">
            <div class="card border-0">
                <div class="card-header bg-transparent border-0 pb-0">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-calendar-alt text-primary me-2"></i>
                        Time Period Selection
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <!-- Year Selection -->
                        <div class="col-md-3 mb-3">
                            <label for="yearSelect" class="form-label fw-semibold">
                                <i class="fas fa-calendar me-2"></i>Select Year
                            </label>
                            <select class="form-select form-select-lg" id="yearSelect" name="year">
                                {% for y in years %}
                                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- Month Selection -->
                        <div class="col-md-9 mb-3">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-calendar-day me-2"></i>Select Month
                            </label>
                            <div class="month-tabs">
                                <div class="nav nav-pills d-flex flex-wrap gap-3" id="monthTabs">
                                    {% for m in months %}
                                        <a class="nav-link {% if forloop.counter == month %}active{% endif %} month-pill"
                                           href="#" data-month="{{ forloop.counter }}">
                                            {{ m }}
                                        </a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .month-pill {
        border-radius: 25px !important;
        padding: 0.75rem 1.5rem !important;
        font-weight: 500;
        transition: all 0.3s ease;
        border: 2px solid transparent;
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
    }
    
    .month-pill:hover {
        background: rgba(102, 126, 234, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .month-pill.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        border-color: #667eea;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .quick-stats .btn {
        border-radius: 20px;
        font-size: 0.75rem;
    }

    .badge {
        border-radius: 15px;
    }

    .card {
        backdrop-filter: blur(10px);
    }
</style>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Get year select
    const yearSelect = document.getElementById('yearSelect');
    // Month tab navigation
    const monthTabs = document.getElementById('monthTabs');
    if (monthTabs) {
        monthTabs.querySelectorAll('a[data-month]').forEach(function(tab) {
            tab.addEventListener('click', function(e) {
                e.preventDefault();
                const selectedMonth = this.getAttribute('data-month');
                const year = yearSelect.value;
                window.location.href = `?year=${year}&month=${selectedMonth}`;
            });
        });
    }
    // Save year to localStorage whenever changed
    yearSelect.addEventListener('change', function() {
        localStorage.setItem('selectedYear', yearSelect.value);
        // On year change, reload page with selected year and current month
        const activeTab = monthTabs.querySelector('a.nav-link.active');
        let month = activeTab ? activeTab.getAttribute('data-month') : '';
        if (!month) month = new Date().getMonth() + 1;
        window.location.href = `?year=${yearSelect.value}&month=${month}`;
    });
    // Restore year from localStorage if not already set by server
    const storedYear = localStorage.getItem('selectedYear');
    if (storedYear && !yearSelect.value) yearSelect.value = storedYear;
});
</script>
{% endblock %}
